# FoodMicrobionet

This repository will eventually contain the different versions of FoodMicrobionet (as Shiny apps and/or R lists) and of the R scripts created to access the data or to do statistical and graphical analysis.

-  file FoodMicrobionet\_tablespecs.md describes the specification for FoodMicrobionet tables

-   folder **dada2_pipeline** contains a modified version of the [DADA2 pipeline](https://benjjneb.github.io/dada2/tutorial.html) suitable for (reasonably) small datasets. I have tested it on oldish Macs (a late 2013 iMac and a late 2015 MacBook Pro, both with 8 Gb RAM) with MacOS 10.14.6 and it works reasonably well with V3-V4 datasets of no more than 50 samples (although you might have to run a few steps overnight). The script has handy options for paired-end and non-paired end files, and for Illumina, IonTorrent and old 454 files. You do need to set a few things and at least have a look at the end of a few steps (quality control, trimming and filtering, ASV inference), but otherwise you don't have to stay there all the time: a beep will alert when a time consuming step is finished. Please pay attention at the structure of folders and files required by the pipeline or adapt the corresponding instructions

-   folder **dada2_pipeline_big_data** will contain a modified version of the previous pipeline and is based of the [DADA2 pipeline](https://benjjneb.github.io/dada2/tutorial.html) for big data. I have tested on the same machines with more than 800 samples (usually V4). It is divided in three parts:

    -   first, the sequences are divided in groups based on the machine lane data of the headers of the fastq files

    -   second, you have to process the sequences in groups (in interactive mode, although you do not have to sit there staring at the screen all the time, a beep will tell you when time consuming steps are finished): the results are sequence tables. Most things are basically what you can find in the bioconductor_pip_v6 script, which you can find in the dada2_pipeline folder

    -   third, a script will merge the sequence tables and perform taxonomic assignment (you can split the process in groups to avoid running into memory problems) and, optionally, infer a phylogenetic tree

    -   fourth: everything is assembled in the objects I need to populate FoodMicrobionet
    
-   folder **import_in_FMBN** contains a script which uses files generated by the two previous scripts (x_study.Rdata, x_taxa.Rdata, x_edges.Rdata, where x is the accession number of the study being imported) to generate a study, taxa and edges file ready to be copied into the .xlsx version of FoodMicrobionet. The script also performs a number of formal checks (to avoid duplicates, NAs, etc.). For taxa, two extra files are needed: a lookup table (species_lookup.txt, included in folder **Support**) and an Excel file named taxa_in_fmbn.xlsx containing all the taxa already in FoodMicrobionet (three columns, taxon name, taxon id and lineage, a toy example is included). This is necessary to keep the taxonomy in FoodMicrobionet coherent as taxonomic databases change, and to make link to external databases functional (epipets like _Clostridium sensu stricto 1 botulinum_ would return no match in Florilege, LPSN and NCBI Taxonomy).  

-  folder **assemble_FMBN** contains the script used for assembling FMBN tables in two R lists, one of which can be used with v2.3 of the ShinyFMBN app and the other containing all fields (a new version of the app compatible with this version will be made available in February 2022). The Excel files are not provided. Contact me if you are interested.  

-  folder **shiny_apps** contains the ShinyFMBN app with the most recent public version. The app makes access to the database easier (although working with custom R scripts is much faster).  
